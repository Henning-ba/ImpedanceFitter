\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{siunitx}
\usepackage{hyperref}
\title{Documentation of the pythonscipt}
\author{Leonard Thiele(lt104)}

\renewcommand{\*}{\cdot}
\begin{document}
\section{General}{
\subsection{Files}{
\begin{itemize}
\item main.py: this is the main file, which holds algorithms for the fitting procedure
\item constants.py: this file holds all constants needed for the calculation. These include geometric and other Parameters(check parametertable.tex to see which parameters are fixed)
\item cole$\_$cole$\_$input.yaml, double$\_$shell$\_$input.yaml or single$\_$shell$\_$input.yaml: holds the starting parameters and boundaries for the corresponding fitting procedure. With the vary bool you can choose if the fit should be able to change this value. 
\end{itemize}
}
\subsection{How it works}{
The script will cycle through all .TXT and .xlsx files in a selected directory and fit those files to a selected model. You can exclude certain files by using the excludeEnding flag.

The first step is, to compensate the electrode polarization of the experiment by fitting the data to a cole-cole-model. After this fit it will fit the data to a selected Model, this can either be the Double$\_$shell$\_$model or the Single$\_$Shell$\_$Model. At the end of the fitting procedure a pdf will be show.   
}%end subsection
\subsection{Parameters in main.py}{
\begin{itemize}
\item LogLevel \begin{itemize}
\item 'DEBUG': the script will output plots after each fit
\item 'INFO': the scipt will output results from each fit to the console
\end{itemize}
\item model: choose the model to which the data should be fitted after the electrode polarization(can either be 'SingleShell' or 'DoubleShell')
\item solvername: choose the solver that should do the fitting. choose among all solvers available in lmfit
\item directory: choose a different directory than the run directory from which the data files should be taken(note: output will be written to this directory as well)
\item for more informations on the parameters, check parametertable.tex
\end{itemize}
}
}%end section
\section{main.py}
\subsection{general formulas, residual calculation}
\begin{equation}
\varepsilon_\mathrm{i}^\ast = \varepsilon_\mathrm{i} - j\*\frac{\sigma_\mathrm{i}}{\varepsilon_\mathrm{0}\*\omega}
\end{equation}
i = ne(nuclear envelope), np(nucleoplasm), m(membrane), cp(cytoplasm), c(cell), sup(supernant(water)), mix(whole mixture(suspension)). \newline
The residual($\delta$) will be calculated according to either: 
\begin{equation}
\delta_\mathrm{real} = 1-\frac{\log_\mathrm{10}(\operatorname{Re}(\varepsilon^\ast)}{\log_\mathrm{10}(\operatorname{Re}(\varepsilon^\ast_\mathrm{fit})}
\end{equation}
\begin{equation}
\delta_\mathrm{imag} = 1- \frac{k}{k_\mathrm{fit}}
\end{equation}
or 
\begin{equation}
\delta = Z - Z_\mathrm{fit}
\end{equation}
depending on the mode chosen. 
\subsection{Setup/Start, reading of data from file}{
In the beginning of each fit, a new outfile.yaml gets written in order to overwrite any old ones. Afterwards the number of Data-Rows gets determined for the first file. The data gets read from the chosen file and the corresponding values for $\varepsilon$, Y and k get calculated: 
\begin{equation}
\varepsilon^\ast = \frac{(Y-j\*w\*c_f)}{(j\*\omega\*c_0)} 
\end{equation}
\begin{equation}
k = \operatorname{Re}(\varepsilon^\ast) \* \omega \* \varepsilon_{\mathrm{0}}
\end{equation}
}
\subsection{compensate electrode-polarization(Cole-Cole-Fit)}
\begin{itemize}
\item the data is fitted to the Cole-Cole-Model twice, in the second fit, the parameters 'conductivity' and '$\varepsilon_\mathrm{h}$' are being fixed. 
\item the starting parameters and boundaries for the variables get read from the .yaml file in the directory of the main.py
\item Equations for calculations in and after the first fit: 
\begin{equation}
Z_\mathrm{ep} = k^{-1} \* j\*\omega^{-\alpha}
\end{equation}
\begin{equation}
\varepsilon_\mathrm{s} = \varepsilon_\mathrm{h} + \frac{\varepsilon_\mathrm{l}-\varepsilon_\mathrm{h}}{1+(j\*\omega\*\tau)^a}
\end{equation}
\begin{equation}
Z_\mathrm{s} = \frac{1}{j\*\varepsilon_\mathrm{s}\*\omega\*c_\mathrm{0} + \frac{\sigma_\mathrm{dc}\*c_\mathrm{0}}{\varepsilon_\mathrm{0}} + j\*\omega\*c_\mathrm{f}}
\end{equation}
\begin{equation}
Z_\mathrm{fit} = Z_\mathrm{s} + Z_\mathrm{ep}
\end{equation}
\end{itemize}

\subsection{Fit experimental data to Double-Shell-Model}
\begin{itemize}
\item depending on the mode selected, the data will either be fitted to this, or to the single-shell-model
\item the calculation for the residual is the same as in the cole-cole-fit
\item Equations for the double-shell-model: 
\begin{equation}
\varepsilon_\mathrm{mix}^\ast = \varepsilon_\mathrm{sup}^\ast\frac{(2\varepsilon_\mathrm{sup}^\ast+\varepsilon_\mathrm{c}^\ast)-2p(\varepsilon_\mathrm{sup}^\ast-\varepsilon_\mathrm{c}^\ast)}{(2\varepsilon_\mathrm{sup}^\ast+\varepsilon_\mathrm{c}^\ast)+p(\varepsilon_\mathrm{sup}^\ast-\varepsilon_\mathrm{c}^\ast)}
\end{equation}
\begin{equation}
\varepsilon_\mathrm{c}^\ast = \varepsilon_\mathrm{m}^\ast\frac{2(1-\nu_\mathrm{1})+(1+2\nu_\mathrm{1})E_\mathrm{1}}{(2+\nu_\mathrm{1})+(1-\nu_\mathrm{1})E_\mathrm{1}}
\end{equation}
\begin{equation}
E_\mathrm{1}  = \frac{\varepsilon_\mathrm{cp}^\ast}{\varepsilon_\mathrm{m}^\ast} \frac{2(1-\nu_\mathrm{2})+(1+2\nu_\mathrm{2})E_\mathrm{2}}{(2+\nu_\mathrm{2})+(1-\nu_\mathrm{2})E_\mathrm{2}}
\end{equation}
\begin{equation}
E_\mathrm{2} = \frac{\varepsilon_\mathrm{ne}^\ast}{\varepsilon_\mathrm{cp}^\ast}\frac{2(1-\nu_\mathrm{3})+(1+2\nu_\mathrm{3})E_\mathrm{3}}{(2+\nu_\mathrm{3})+(1-\nu_\mathrm{3})E_\mathrm{3}}
\end{equation}
\begin{equation}
E_\mathrm{3} = \frac{\varepsilon_\mathrm{np}^\ast}{\varepsilon_\mathrm{ne}^\ast}
\end{equation}
\item $R \hat{=}$ outer cell Radius; $R_\mathrm{n} \hat{=}$ outer Radius of the nucleus; $d \hat{=}$ thickness of the membrane
\begin{equation}
\nu_\mathrm{1} = \left(1-\frac{d}{R}\right)^3
\end{equation}
\begin{equation}
\nu_\mathrm{2} = \left(\frac{R_\mathrm{n}}{R-d}\right)^3
\end{equation}
\begin{equation}
\nu_\mathrm{3} = \left(1-\frac{d_\mathrm{n}}{R_\mathrm{n}}\right)^3
\end{equation}

\item 1st Fit: the parameters $k$ and $\alpha$ are fixed(coming from cole-cole-fit), and the data is fitted against the double-shell-model.To be determined in this fit: $\sigma_\mathrm{sup} / k_\mathrm{med}$ . 
\item 2nd Fit: the parameters $k$, $\alpha$ and $\sigma_\mathrm{sup}$ are fixed and the data is fitted again.To be determined in this fit: $\sigma_\mathrm{m}$, $\varepsilon_\mathrm{m}$, $\sigma_\mathrm{cp}$. 
\item 3rd Fit: the parameters $k$, $\alpha$, $\sigma_\mathrm{sup}$, $\sigma_\mathrm{m}$ and $\varepsilon_\mathrm{m}$ are fixed and the data is fitted again. To be determined in this fit: $\sigma_\mathrm{cp}$.

\item last Fit: the parameters $k$, $\alpha$, $\sigma_\mathrm{sup}$, $\sigma_\mathrm{ne}$, $\sigma_\mathrm{np}$, $\sigma_\mathrm{m}$, $\varepsilon_\mathrm{m}$ are fixed. To be determined in this fit: $\varepsilon_\mathrm{ne}$, $\sigma_\mathrm{ne}$, $\varepsilon_\mathrm{np}$, $\sigma_\mathrm{np}$.
\end{itemize}
\subsection{Fit experimental data to Single-Shell-Model}
\begin{itemize}
\item the calculation for the residual is the same as in the cole-cole-fit
\item the data only gets fitted once
\item Equations for the single-shell-model($\nu1$ is calculated like in the double-shell-model): 
\begin{equation}
\varepsilon_\mathrm{cell}^* = \varepsilon_\mathrm{m}^* * \frac{(2 * (1 - \nu1) + (1 + 2 * \nu1) * E1}{((2 + \nu1) + (1 - -\nu1) * E1}
\end{equation}
\begin{equation}
E1 = \frac{\varepsilon_\mathrm{cp}^*}{\varepsilon_\mathrm{m}^*}
\end{equation}
\begin{equation}
\varepsilon_\mathrm{sus}^* = \varepsilon_\mathrm{med}^* * \frac{2 * (1- p) + (1 + 2 * p) * E0}{(2 + p) + (1- p) * E0}
\end{equation}
\begin{equation}
E0  = \frac{\varepsilon_\mathrm{cell}^*}{\varepsilon_\mathrm{med}^*}
\end{equation}
\end{itemize}
\subsection{post processing}
After the fit to one of the models has finished, the calculated values get written into the 'outfile.yaml' in the data-directory. When the whole run has finished, a pdf is drawn from all results. If you only want to see the pdf, you can run the $post\_process\_standalone.py$. Here you have to select the correct direcory and parameter. 
\end{document}

